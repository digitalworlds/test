<!DOCTYPE html>
<html>
<head>
	<title>op.n</title>
	<meta charset="utf-8"/>
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	
	<link rel="shortcut icon" href="img/logo.png" />
	<link rel="icon" href="img/logo.png" /> 
	<link rel="apple-touch-icon" href="img/logo.png" />
	
	<meta property="og:url" content="" />
	<meta property="og:title" content="op.n" />
	<meta property="og:description" content="A portable web-based operating system" />
	<meta property="og:type" content="website" />
	<meta property="og:image:width" content="100" />
	<meta property="og:image:height" content="100" />
    <meta property="og:image" content="img/logo.png" />
	<meta property="og:image:type" content="image/png" />
	
	<style>
        @-ms-viewport { width: 100vw ; min-zoom: 100% ; zoom: 100% ; }          @viewport { width: 100vw ; min-zoom: 100%; zoom: 100% ; }
        @-ms-viewport { user-zoom: fixed ; min-zoom: 100% ; }                   @viewport { user-zoom: fixed ; min-zoom: 100% ; }
	</style>
	<script type="text/javascript" src="js/opn.js"></script>
	<script type="text/javascript">
	var my_program=function()
	{
		opn.getProgress().oneMoreToDo();
		opn.showProgress({div:document.body});
		console.log('My program started');
		if(opn.static && location.search.indexOf('?app/')==0)
		{
			let loadapp=()=>{
				if(oid.indexOf('@')==-1)oid=oid+'@'+opn.cloudhost;
				
				opn.cloud.getObject(oid).whenReady().then((o)=>{
					
					new opn.App().load(opn.viewers['OS']).then((Assets)=>{
						let os=new Assets.opnOS({parentDiv:opn.getScreen()});	
						
						opn.getProgress().oneMoreDone();
						console.log(opn.getProgress().getValue())
						
						let app=null;
						
						if(command.indexOf('/code')==0){
							app=os.openApp({initapp:true,appID:opn.viewers['Code'],input:o});
						}
						else if(command.indexOf('/api')==0){
							app=os.openApp({initapp:true,appID:opn.viewers['API'],input:oid});
						}else{
							
							if(o.getSystemProperty('OPEN')){
								app=os.openApp({initapp:true,appID:o.getSystemProperty('OPEN'),input:oid});
							} else if (o.getSystemProperty('CLASS')){
								let c=o.getSystemProperty('CLASS');
								if(c=='List'){
									app=os.openApp({initapp:true,appID:opn.viewers['List'],input:oid});
								}else if(c=='Image'){
									app=os.openApp({initapp:true,appID:opn.viewers['Image'],input:oid});
								}else if(c=='User'){
									app=os.openApp({initapp:true,appID:opn.viewers['User'],input:oid});
								}else{
									app=os.openApp({initapp:true,fullscreen:embed,appID:oid});
								}
							}
							else {
								app=os.openApp({initapp:true,fullscreen:embed,appID:oid});
							}
						}
						app.getWindow().maximize();
					});
				}).otherwise(()=>{
					console.log('This object is not available');
				});
			}
			var command='';
			var oid='';
			var embed=false;
			
			
				let end=location.search.indexOf('/',5);
				if(end==-1)end=undefined;
				else command=location.search.substring(end);
				if(command.indexOf('/embed')==0)embed=true;
				let app_name=location.search.substring(5,end);
				opn.http(location.href.substring(0,location.href.indexOf('?'))+'apps/'+app_name).then((request)=>{
					oid=request.responseText.split("\n")[0];
					loadapp();
				})
			
			return;
		}
		if(opn.redirectServerSite){location.href=opn.redirectServerSite;return}
		new opn.App().load(opn.landing);
		opn.getProgress().oneMoreDone();
	}
	</script>
</head>
<body onload="opn.run(my_program,{loadingLogo:true})" style="margin:0px;background:#fff;color:#888;"></body>
<div style="position:absolute;inset:0px;overflow:hidden;"><div style="display:flex;align-items:center;justify-content:center;height:100%;font-family:Arial,sans-serif;">Connecting...</div></div>
</html>